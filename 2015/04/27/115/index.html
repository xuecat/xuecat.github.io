<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="函数和结构," />





  <link rel="alternate" href="/atom.xml" title="XueCat" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/picture/favicon.ico?v=5.0.2" />






<meta name="description" content="REMARKwdk7用于vs2010wdk8用于vs2012wdk8.1用于vs2013装了低版本的，没法整合高版本到vs的了。还有最好自己去vs默认的地方下载，免得手动下载出错
函数 OBJ_CASE_INSENSITIVE不区分大小写，进行字符比对寻找驱动
 ObDereferenceObeject减少对读取到的引用计数，一般是Reference函数，都要减少。IoGetDeviceObjec">
<meta property="og:type" content="article">
<meta property="og:title" content="驱动笔记115">
<meta property="og:url" content="https://xuecat.github.io/2015/04/27/115/index.html">
<meta property="og:site_name" content="XueCat">
<meta property="og:description" content="REMARKwdk7用于vs2010wdk8用于vs2012wdk8.1用于vs2013装了低版本的，没法整合高版本到vs的了。还有最好自己去vs默认的地方下载，免得手动下载出错
函数 OBJ_CASE_INSENSITIVE不区分大小写，进行字符比对寻找驱动
 ObDereferenceObeject减少对读取到的引用计数，一般是Reference函数，都要减少。IoGetDeviceObjec">
<meta property="og:updated_time" content="2016-08-28T05:23:19.455Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="驱动笔记115">
<meta name="twitter:description" content="REMARKwdk7用于vs2010wdk8用于vs2012wdk8.1用于vs2013装了低版本的，没法整合高版本到vs的了。还有最好自己去vs默认的地方下载，免得手动下载出错
函数 OBJ_CASE_INSENSITIVE不区分大小写，进行字符比对寻找驱动
 ObDereferenceObeject减少对读取到的引用计数，一般是Reference函数，都要减少。IoGetDeviceObjec">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="https://xuecat.github.io/2015/04/27/115/"/>


  <title> 驱动笔记115 | XueCat </title>
</head>

<div id="hexo-helper-live2d">
  <canvas id="live2dcanvas" width="150" height="300"></canvas>
</div>
<style>
  #live2dcanvas{
    position: fixed;
    width: 150px;
    height: 300px;
    opacity:0.7;
    left: 0px;
    z-index: 999;
    pointer-events: none;
    bottom: 0px;
  }
</style>
<script type="text/javascript" src="/live2d/device.min.js"></script>
<script type="text/javascript">
const loadScript = function loadScript(c,b){var a=document.createElement("script");a.type="text/javascript";"undefined"!=typeof b&&(a.readyState?a.onreadystatechange=function(){if("loaded"==a.readyState||"complete"==a.readyState)a.onreadystatechange=null,b()}:a.onload=function(){b()});a.src=c;document.body.appendChild(a)};
(function(){
  if((typeof(device) != 'undefined') && (device.mobile())){
    document.getElementById("live2dcanvas").style.width = '75px';
    document.getElementById("live2dcanvas").style.height = '150px';
  }else
    if (typeof(device) === 'undefined') console.error('Cannot find current-device script.');
  loadScript("/live2d/script.js", function(){loadlive2d("live2dcanvas", "/live2d/assets/z16.model.json", 0.5);});
})();
</script>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">XueCat</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">用代码创造世界</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                驱动笔记115
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-04-27T03:33:58+08:00" content="2015-04-27">
              2015-04-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/驱动/" itemprop="url" rel="index">
                    <span itemprop="name">驱动</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="REMARK"><a href="#REMARK" class="headerlink" title="REMARK"></a>REMARK</h1><p>wdk7用于vs2010<br>wdk8用于vs2012<br>wdk8.1用于vs2013<br>装了低版本的，没法整合高版本到vs的了。还有最好自己去vs默认的地方下载，免得手动下载出错</p>
<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><p> <strong>OBJ_CASE_INSENSITIVE</strong>不区分大小写，进行字符比对寻找驱动</p>
<p> <strong>ObDereferenceObeject</strong>减少对读取到的引用计数，一般是Reference函数，都要减少。<br><strong>IoGetDeviceObjectPointer</strong>查阅msdn发现也要用它来减少，以后对设备的打开都要用它来进行减少。  只有减少到0才能被系统所卸载销毁。</p>
<p><strong>DO_POWER_PAGABLE</strong>:如果IRP_MJ_POWER请求的派遣函数必须运行在PASSIVE_LEVEL级别，你需要设置DO_POWER_PAGABLE标志。该标志的名称含有相关的含义，因为只有在PASSIVE_LEVEL级上才允许分页操作。如果你把该标志设置为0，则电源管理器可以在DISPATCH_LEVEL级上向你发送电源管理请求<br>(更多关于设备对象的type可以去看张帆89上面的)</p>
<p><strong>IoCreateDevice</strong><br>设备对象名：字符串必须是”\Device[设备名]”(UNICODE)<br>如：C盘（\Device\HarddiskVolume1）D盘（\Device\HarddiskVolume2）。如果不指定名字，会默认给一个数字来当做名。然而“c:，d:”这一类的是符号链接字符。<br><br>这个函数的倒数第二个参数，表示产生的对象是用于内核模式还是用户模式。在内核模式下，符号链接是以”\??\”（或者\DosDevices）开头。在用户模式下，是以”\.\”开头<br>注意，再看下它第二个参数。大小是扩展项的大小，不然后面强制转换扩展项会越界，并发生泄漏。</p>
<p><strong>DO_DIRECT_IO和DO_BUFFERED_IO</strong> 自己去保存页看吧。。</p>
<h1 id="inf"><a href="#inf" class="headerlink" title="inf"></a>inf</h1><p>看下inf结构：</p>
<pre><code>Version Section
SourceDisksNames Section
SourceDisksFiles Section
ClassInstall32 Section（可选）
ClassInstall32.Services Section（可选）
DestinationDirs Section
ControlFlags Section
Manufacturer Section
    Models Section (per Manufacturer entry)
        DDInstall Section (per Models entry)
        DDInstall.Services Section
        DDInstall.HW Section
        DDInstall.CoInstallers Section
        DDInstall.FactDef Section
        DDInstall.LogConfigOverride Section
        DDInstall.Interfaces Section
InterfaceInstall32 Section
DefaultInstall Section
DefaultInstall.Services Section
Strings Section
</code></pre><p><strong>DestinationDirs</strong>安装目录(用代号表示)</p>
<p><strong>SourceDisksNames</strong> 源文件目录。如果忽略，就会从inf文件目录找。可以设置为inf相对目录或者绝对目录。</p>
<p><strong>class</strong>这个字段会在指定的设备名添加</p>
<p><strong>ClassInstall</strong>当加载自定义的驱动时候，用这个。它会新建一个设备，就不是从已有设备做过滤啥的。（官方：A ClassInstall32 section installs a new device setup class (and possibly a class installer) for devices in the new class.）</p>
<p><a href="https://msdn.microsoft.com/zh-cn/library/windows/hardware/ff546335" target="_blank" rel="external">https://msdn.microsoft.com/zh-cn/library/windows/hardware/ff546335</a>  这里有它必须包含的字段</p>
<p><strong>DefaultInstall</strong> 当右键“安装”时候访问(没有字段却点击会报错)（section is accessed if a user selects the “Install” menu item after right-clicking on the INF file name.）<br><br>通过remarks知道，这个字段不能用来当做设备驱动安装，仅用于类过滤驱动，类共同安装，文件系统过滤驱动，内核驱动服务程序等不与设备驱动关联的服务。<br>数字签名不能使用这个字段<br> Unlike a DDInstall section, a DefaultInstall section cannot contain DriverVer or LogConfig directives.(和ddinstall的不同)</p>
<p><strong>ddinstall</strong> 每个DDInstall Section包含一个可选项DriverVer指令，adreg好像也是必选<br>从marks知道，它用于安装段名（自定义），指定有或没有平台。（详细看<a href="https://msdn.microsoft.com/zh-cn/library/windows/hardware/ff547344）" target="_blank" rel="external">https://msdn.microsoft.com/zh-cn/library/windows/hardware/ff547344）</a><br>所以Manufacturer是安装入口（这个必选联系理解，下面就说它，）</p>
<p><strong>Manufacturer</strong>：官方的name我有点不懂就跳过，讲点大众的。</p>
<pre><code>%strkey%=models-section-name [,TargetOSVersion] [,TargetOSVersion] ...  (Windows XP and later versions of Windows)
</code></pre><p>strkey是string段里面的被代替为name<br><br>models-section-name 这里理解为另一个节（section翻译都行）<br><br>version最后的是平台，可以选择多个平台，但是也就意味着相应的model节也必需匹配平台信息。(有时会有个主版本号和副版本号，我们用它来确定系统xpwin7)<br><br>如：%MFGNAME% = MyDevice_WinUSB,NTx86,NTamd64后面就必需有<br>[MyDevice_WinUSB.NTx86]和[MyDevice_WinUSB.NTamd64]节</p>
<p><strong>Models</strong><br><br>device-description=install-section-name[,hw-id][,compatible-id…]</p>
<p>desciption:是个string节的id(中文就是设备描述)<br><br>section-name:<br>然后，这个就是ddinstall的模块了。<br><br>hw-id:指定一个设备制造商定义的硬件ID串(hardware ID string)。PnP管理器用这个项来找匹配的INF文件<br><br>compatible-id:指定一个设备制造商定义的兼容ID字符串(compatible ID string)。同时可以指定多个compatible-id，之间用逗号隔开<br>后面俩个不是很理解，以后来更新。<br></p>
<h1 id="INF-三键"><a href="#INF-三键" class="headerlink" title="INF 三键"></a>INF 三键</h1><p>硬件子键：<br>这里是对设备的键值修饰，“我的电脑”右键“管理”，指的便是这里的硬件设备。当然可以通过classinstall添加一个设备，或是虚拟设备<br>在这个里面内容主要是厂家设备信息（msdn就说过通过models的俩个id给设备增添加服务），然后为了唯一性有个类子键（classguid管理），服务性有个服务子键（加载的具体驱动服务，sys，几个type）</p>
<p>类子键：<br>一个类键管理一个设备。<br>（以下自己理解，有待修改）<br>“我的电脑”右键“管理”这么多个设备被格子guid标识，当厂家要在某个设备下添加驱动时，就把class和classguid弄上去，但Manufacturer是厂家自己的信息，当驱动更新时，系统会更快通过这些信息更新。<br>所以一个设备下可能有很多个驱动。</p>
<p>服务子键：<br>俩个type和错误type，和sys文件路径</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/函数和结构/" rel="tag">#函数和结构</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/04/26/114/" rel="next" title="常量折叠和debug填充114">
                <i class="fa fa-chevron-left"></i> 常量折叠和debug填充114
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/05/11/116/" rel="prev" title="驱动">
                驱动 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/picture/head.jpg"
               alt="XueCat" />
          <p class="site-author-name" itemprop="name">XueCat</p>
          <p class="site-description motion-element" itemprop="description">如谬误，望告知</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">247</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">18</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">56</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.v2ex.com/?r=xuecat" target="_blank" title="V2EX">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  V2EX
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="mailto:1446969391@qq.com" target="_blank" title="E-mail">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  E-mail
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.yunyingyong.sinaapp.com/gx.html" title="Funny" target="_blank">Funny</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://guge.suanfazu.com/" title="Google" target="_blank">Google</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://plus.google.com/communities/104092405342699579599/stream/8a593591-2091-4096-bb00-7d9c5659db93" title="shadowsocks免费账号" target="_blank">shadowsocks免费账号</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#REMARK"><span class="nav-number">1.</span> <span class="nav-text">REMARK</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#函数"><span class="nav-number">2.</span> <span class="nav-text">函数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#inf"><span class="nav-number">3.</span> <span class="nav-text">inf</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#INF-三键"><span class="nav-number">4.</span> <span class="nav-text">INF 三键</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2013 - 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">XueCat</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  



  




  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = false;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = decodeURIComponent(data.url);
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title >= 0 || index_content >= 0 ){
                                isMatch = true;
								if (i == 0) {
                                    first_occur = index_content;
                                }
                            } 
							
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

  

  <script type="text/javascript" src="/js/src/particle.js"></script>
  //<script type="text/javascript" src="/js/src/chuncai.js"></script>
  //<script type="text/javascript">
  //      $.chuncai();
  //</script>
</body>
</html>
